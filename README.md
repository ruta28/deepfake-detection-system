Deepfake Detection SystemThis project implements a deep learning system for detecting deepfake images using PyTorch. It leverages a powerful pre-trained EfficientNet model combined with an LSTM layer for feature analysis and includes explainability through Grad-CAM heatmaps. The system is designed to handle imbalanced datasets and has been fine-tuned to address challenging examples.Key FeaturesDeepfake Detection: Classifies images as either "REAL" or "FAKE".High Performance: Achieves high recall for detecting fake images after addressing data imbalance and fine-tuning.Explainability: Generates Grad-CAM heatmaps to visualize which parts of an image the model focused on for its prediction.Transfer Learning: Uses a pre-trained EfficientNet-B0 backbone for robust feature extraction.Data Handling: Includes mechanisms for handling large datasets (Git LFS) and imbalanced classes (oversampling).Project Structure├── data/               # Dataset (requires Git LFS)
│   ├── train/
│   │   ├── real/
│   │   └── fake/
│   └── val/
│       ├── real/
│       └── fake/
├── src/                # Source code
│   ├── datasets/       # Dataset loading logic (deepfake_dataset2.py)
│   ├── explainability/ # Grad-CAM implementation (gradcam.py)
│   ├── models/         # Model architectures (cnn_lstm.py, efficientnet_lstm.py)
│   ├── evaluate.py     # Script for evaluating model performance
│   ├── finetune.py     # Script for fine-tuning on failure cases
│   ├── main.py         # Script for predicting a single image with Grad-CAM
│   └── train.py        # Script for training the model
├── .gitattributes      # Git LFS configuration
├── .gitignore          # Files ignored by Git
├── best_model.pth      # Placeholder for trained model weights (generated by train.py)
├── best_model_finetuned.pth # Final fine-tuned model weights (generated by finetune.py)
├── failures.json       # List of failed predictions (generated by evaluate.py)
├── requirements.txt    # Python dependencies
└── README.md           # This file
Setup Instructions1. Prerequisites:Python 3.9+Git (https://git-scm.com/downloads)Git LFS (https://git-lfs.com) - Install after installing Git.2. Clone the Repository:Clone the repository using HTTPS and your Personal Access Token (PAT) for authentication to enable LFS downloads. Replace <YOUR_PAT> and <YOUR_USERNAME>.git clone https://<YOUR_USERNAME>:<YOUR_PAT>@[github.com/ruta28/deepfake-detection-system.git](https://github.com/ruta28/deepfake-detection-system.git)
cd deepfake-detection-system
Download the large data files tracked by Git LFS:git lfs pull
(Note: This requires authentication via PAT or having billing enabled if data exceeds GitHub's free tier.)3. Set Up Virtual Environment:Create a virtual environment:python -m venv .venv
Activate the environment:Windows (PowerShell): .\.venv\Scripts\activatemacOS/Linux: source .venv/bin/activate4. Install Dependencies:pip install -r requirements.txt
Usage1. Training (Requires GPU - Recommended via Google Colab):The primary training script utilizes EfficientNet-LSTM, data augmentation, and oversampling.Ensure your dataset is correctly placed in the data/train and data/val folders.Run the training script:python -m src.train
This will train the model, perform early stopping, and save the best weights to best_model.pth.(See Colab setup steps in previous chat messages for running on a free GPU).2. Evaluating Model Performance:After training, evaluate the model on the validation set to get detailed metrics and identify failure cases.Make sure best_model.pth (from training) exists in the root directory.Run the evaluation script:python -m src.evaluate
This will print a classification report, a confusion matrix, and save incorrect predictions to failures.json.3. Fine-Tuning on Failures (Optional but Recommended):If the evaluation identifies errors (failures.json is created), you can fine-tune the model specifically on these hard examples.Ensure best_model.pth and failures.json are present.Run the fine-tuning script (runs quickly on CPU):python -m src.finetune
This creates the final, refined model weights: best_model_finetuned.pth.4. Predicting a Single Image (with Explainability):Use the main.py script to get a prediction for a single image and generate its Grad-CAM heatmap.Use the final, fine-tuned model weights for best results.python -m src.main --frame path/to/your/image.jpg --weights best_model_finetuned.pth --out output_directory_name
Example:python -m src.main --frame data/val/fake/some_fake_image.jpg --weights best_model_finetuned.pth --out evidence_example
The script will print a JSON output with the decision, probability, and heatmap path:{
    "decision": "FAKE",
    "probability": 0.9999...,
    "heatmap": "output_directory_name/gradcam.png"
}
PerformanceAfter training the EfficientNet-LSTM model with oversampling, aggressive augmentation, and fine-tuning, the system achieves high performance, particularly in identifying fake images (high recall) while maintaining reasonable precision. Refer to the output of src/evaluate.py (run with best_model_finetuned.pth) for the exact metrics.Explainability (Grad-CAM)The main.py script automatically generates a Grad-CAM heatmap (gradcam.png) saved in the specified output directory. This heatmap visually highlights the regions of the input image that were most influential in the model's decision, providing insights into its reasoning. Red/yellow areas indicate higher importance.Future WorkIntegrate video processing to analyze video files frame-by-frame.Experiment with different pre-trained backbones (e.g., Vision Transformer).Develop a web API (Flask/FastAPI) and frontend (React) for easier interaction.Explore more advanced deepfake detection techniques (e.g., frequency analysis, GAN fingerprints).